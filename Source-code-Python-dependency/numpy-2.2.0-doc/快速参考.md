# NumPy 快速参考手册

## 目录结构速查

```
numpy/
├── _core/              # 核心实现（原 numpy.core）
│   ├── multiarray     # 多维数组核心
│   ├── umath          # 通用数学函数
│   ├── numeric        # 数值操作
│   ├── numerictypes   # 数值类型
│   └── src/           # C/C++ 源码
├── lib/               # 辅助工具库
├── linalg/            # 线性代数
├── random/            # 随机数生成
├── fft/               # 傅里叶变换
├── polynomial/        # 多项式
├── ma/                # 掩码数组
├── testing/           # 测试工具
└── typing/            # 类型标注
```

## 模块导入速查

```python
import numpy as np                      # 标准导入

# 子模块
from numpy import linalg               # 线性代数
from numpy import random               # 随机数
from numpy import fft                  # FFT
from numpy.random import default_rng   # 新随机API

# 类型标注
from numpy.typing import NDArray, ArrayLike
```

## 数据类型速查表

### 整数类型

| 类型 | 字节 | 范围 | 别名 |
|------|------|------|------|
| `int8` | 1 | -128 到 127 | `i1`, `byte` |
| `int16` | 2 | -32768 到 32767 | `i2`, `short` |
| `int32` | 4 | -2³¹ 到 2³¹-1 | `i4`, `intc` |
| `int64` | 8 | -2⁶³ 到 2⁶³-1 | `i8`, `longlong` |
| `uint8` | 1 | 0 到 255 | `u1`, `ubyte` |
| `uint16` | 2 | 0 到 65535 | `u2`, `ushort` |
| `uint32` | 4 | 0 到 2³²-1 | `u4`, `uintc` |
| `uint64` | 8 | 0 到 2⁶⁴-1 | `u8`, `ulonglong` |

### 浮点类型

| 类型 | 字节 | 精度 | 别名 |
|------|------|------|------|
| `float16` | 2 | ~3位十进制 | `f2`, `half` |
| `float32` | 4 | ~7位十进制 | `f4`, `single` |
| `float64` | 8 | ~16位十进制 | `f8`, `double` |

### 其他类型

| 类型 | 说明 |
|------|------|
| `complex64` | 单精度复数（2个float32） |
| `complex128` | 双精度复数（2个float64） |
| `bool_` | 布尔类型 |
| `str_` | Unicode字符串 |
| `bytes_` | 字节串 |
| `object_` | Python对象 |
| `datetime64` | 日期时间 |
| `timedelta64` | 时间差 |

## 数组创建函数

```python
# 从数据创建
np.array([1, 2, 3])                    # 列表转数组
np.array([[1, 2], [3, 4]])             # 二维数组
np.asarray(data)                       # 转换为数组

# 初始化数组
np.zeros((3, 4))                       # 零数组
np.ones((2, 3))                        # 全1数组
np.empty((2, 2))                       # 未初始化
np.full((2, 3), 7)                     # 填充值
np.eye(3)                              # 单位矩阵
np.identity(3)                         # 单位矩阵

# 范围数组
np.arange(0, 10, 2)                    # [0, 2, 4, 6, 8]
np.linspace(0, 1, 5)                   # [0, 0.25, 0.5, 0.75, 1]
np.logspace(0, 2, 3)                   # [1, 10, 100]

# 随机数组
rng = np.random.default_rng(seed=42)
rng.random((3, 4))                     # 均匀分布[0,1)
rng.integers(0, 10, size=5)            # 随机整数
rng.normal(0, 1, size=(3, 3))          # 正态分布

# 类似数组
np.zeros_like(arr)                     # 相同形状的零数组
np.ones_like(arr)                      # 相同形状的全1数组
np.empty_like(arr)                     # 相同形状的空数组
```

## 数组属性

```python
arr.shape           # 形状 (行, 列, ...)
arr.size            # 元素总数
arr.ndim            # 维度数
arr.dtype           # 数据类型
arr.itemsize        # 每个元素的字节数
arr.nbytes          # 总字节数
arr.strides         # 步长
arr.flags           # 内存布局信息
arr.T               # 转置
arr.real            # 实部
arr.imag            # 虚部
```

## 索引和切片

```python
# 基础索引
arr[0]                  # 第一个元素
arr[-1]                 # 最后一个元素
arr[1:4]                # 切片 [1, 2, 3]
arr[::2]                # 步长为2
arr[::-1]               # 反转

# 多维索引
arr[0, 1]               # 第0行第1列
arr[0, :]               # 第0行全部
arr[:, 1]               # 第1列全部
arr[1:3, 0:2]           # 子矩阵

# 花式索引
arr[[0, 2, 4]]          # 指定索引
arr[[1, 2], [0, 1]]     # 多维花式索引

# 布尔索引
arr[arr > 5]            # 大于5的元素
arr[mask]               # 使用布尔数组
arr[~mask]              # 取反

# 条件赋值
arr[arr > 5] = 0        # 将大于5的设为0
np.where(arr > 5, 0, arr)  # 条件替换
```

## 形状操作

```python
# 改变形状
arr.reshape(3, 4)       # 改变形状（可能返回视图）
arr.resize(3, 4)        # 原地改变形状
arr.ravel()             # 展平（视图）
arr.flatten()           # 展平（拷贝）

# 转置
arr.T                   # 转置
arr.transpose()         # 转置
np.swapaxes(arr, 0, 1)  # 交换轴

# 添加/删除维度
arr[np.newaxis, :]      # 添加维度
np.expand_dims(arr, 0)  # 添加维度
np.squeeze(arr)         # 删除长度为1的维度

# 拼接
np.concatenate([a, b])  # 拼接
np.vstack([a, b])       # 垂直堆叠
np.hstack([a, b])       # 水平堆叠
np.stack([a, b])        # 沿新轴堆叠

# 分割
np.split(arr, 3)        # 分成3份
np.hsplit(arr, 2)       # 水平分割
np.vsplit(arr, 2)       # 垂直分割

# 重复和平铺
np.repeat(arr, 3)       # 重复元素
np.tile(arr, (2, 3))    # 平铺数组
```

## 数学运算

### 算术运算

```python
a + b, np.add(a, b)             # 加法
a - b, np.subtract(a, b)        # 减法
a * b, np.multiply(a, b)        # 乘法
a / b, np.divide(a, b)          # 除法
a // b, np.floor_divide(a, b)   # 整除
a % b, np.mod(a, b)             # 取模
a ** b, np.power(a, b)          # 幂
np.sqrt(a)                      # 平方根
np.abs(a)                       # 绝对值
```

### 比较运算

```python
a == b, np.equal(a, b)          # 等于
a != b, np.not_equal(a, b)      # 不等于
a < b, np.less(a, b)            # 小于
a <= b, np.less_equal(a, b)     # 小于等于
a > b, np.greater(a, b)         # 大于
a >= b, np.greater_equal(a, b)  # 大于等于
```

### 逻辑运算

```python
a & b, np.logical_and(a, b)     # 逻辑与
a | b, np.logical_or(a, b)      # 逻辑或
~a, np.logical_not(a)           # 逻辑非
a ^ b, np.logical_xor(a, b)     # 逻辑异或
```

### 三角函数

```python
np.sin(x), np.cos(x), np.tan(x)         # 三角函数
np.arcsin(x), np.arccos(x), np.arctan(x) # 反三角
np.sinh(x), np.cosh(x), np.tanh(x)      # 双曲函数
np.deg2rad(x), np.rad2deg(x)            # 角度转换
```

### 指数和对数

```python
np.exp(x)           # e^x
np.exp2(x)          # 2^x
np.log(x)           # ln(x)
np.log2(x)          # log2(x)
np.log10(x)         # log10(x)
np.log1p(x)         # ln(1+x)
```

## 统计函数

```python
# 基础统计
np.sum(arr)         # 求和
np.mean(arr)        # 均值
np.std(arr)         # 标准差
np.var(arr)         # 方差
np.min(arr)         # 最小值
np.max(arr)         # 最大值
np.median(arr)      # 中位数
np.percentile(arr, 25)  # 百分位数
np.quantile(arr, 0.25)  # 分位数

# 沿轴操作
np.sum(arr, axis=0)     # 列和
np.mean(arr, axis=1)    # 行均值

# 累积操作
np.cumsum(arr)      # 累加
np.cumprod(arr)     # 累乘

# 位置
np.argmin(arr)      # 最小值索引
np.argmax(arr)      # 最大值索引
np.where(arr > 5)   # 满足条件的索引

# NaN 处理
np.nansum(arr)      # 忽略NaN求和
np.nanmean(arr)     # 忽略NaN均值
np.nanstd(arr)      # 忽略NaN标准差
```

## 线性代数 (numpy.linalg)

```python
# 矩阵乘法
a @ b                   # 矩阵乘法
np.dot(a, b)            # 点积
np.matmul(a, b)         # 矩阵乘法
np.inner(a, b)          # 内积
np.outer(a, b)          # 外积

# 矩阵分解
np.linalg.cholesky(a)   # Cholesky分解
Q, R = np.linalg.qr(a)  # QR分解
U, s, Vh = np.linalg.svd(a)  # SVD分解

# 特征值
eigenvals, eigenvecs = np.linalg.eig(a)    # 特征值和特征向量
eigenvals = np.linalg.eigvals(a)           # 仅特征值

# 求解方程
x = np.linalg.solve(A, b)    # 求解 Ax=b
x = np.linalg.lstsq(A, b)    # 最小二乘解

# 矩阵性质
np.linalg.det(a)        # 行列式
np.linalg.inv(a)        # 逆矩阵
np.linalg.pinv(a)       # 伪逆
np.linalg.matrix_rank(a) # 秩
np.linalg.norm(a)       # 范数
np.linalg.cond(a)       # 条件数
np.trace(a)             # 迹
```

## 随机数 (numpy.random)

```python
# 新API（推荐）
rng = np.random.default_rng(seed=42)

# 均匀分布
rng.random()            # [0, 1)
rng.integers(0, 10)     # [0, 10)
rng.choice([1,2,3,4,5]) # 随机选择

# 正态分布
rng.normal(0, 1, size=100)       # N(0,1)
rng.standard_normal(100)         # N(0,1)

# 其他分布
rng.uniform(0, 1)       # 均匀分布
rng.exponential(1.0)    # 指数分布
rng.poisson(5)          # 泊松分布
rng.binomial(10, 0.5)   # 二项分布

# 排列
rng.permutation(arr)    # 随机排列
rng.shuffle(arr)        # 原地打乱
```

## 傅里叶变换 (numpy.fft)

```python
# 一维FFT
fft = np.fft.fft(signal)        # 正向FFT
signal = np.fft.ifft(fft)       # 逆FFT

# 实数FFT
rfft = np.fft.rfft(real_signal) # 实数FFT
signal = np.fft.irfft(rfft)     # 逆实数FFT

# 二维FFT
fft2 = np.fft.fft2(image)       # 2D FFT
image = np.fft.ifft2(fft2)      # 逆2D FFT

# 频率
freqs = np.fft.fftfreq(n, d=1.0)    # FFT频率
rfreqs = np.fft.rfftfreq(n, d=1.0)  # 实数FFT频率

# 移位
shifted = np.fft.fftshift(fft)      # 零频移到中心
original = np.fft.ifftshift(shifted) # 逆移位
```

## I/O 操作

```python
# 二进制
np.save('data.npy', arr)        # 保存单个数组
arr = np.load('data.npy')       # 加载

np.savez('data.npz', a=arr1, b=arr2)  # 保存多个数组
data = np.load('data.npz')
arr1 = data['a']

np.savez_compressed('data.npz', arr)  # 压缩保存

# 文本
np.savetxt('data.txt', arr)     # 保存为文本
arr = np.loadtxt('data.txt')    # 加载文本

np.savetxt('data.csv', arr, delimiter=',')  # CSV
arr = np.loadtxt('data.csv', delimiter=',')

# 高级文本加载
arr = np.genfromtxt('data.csv', delimiter=',', skip_header=1)
```

## 广播规则

```python
# 标量广播
arr + 5                 # 每个元素+5

# 一维到二维
arr_2d + arr_1d         # 自动广播

# 显式广播
result = arr[:, np.newaxis] + arr[np.newaxis, :]

# 检查广播
np.broadcast_shapes((3,1), (1,4))  # (3,4)
```

## 常用技巧

### 条件操作

```python
# where
result = np.where(condition, x, y)  # 条件选择

# clip
clipped = np.clip(arr, 0, 100)      # 限制范围

# select
conditions = [arr < 0, arr == 0, arr > 0]
choices = [-1, 0, 1]
result = np.select(conditions, choices)
```

### 唯一值和集合

```python
np.unique(arr)              # 唯一值
np.unique(arr, return_counts=True)  # 返回计数
np.intersect1d(a, b)        # 交集
np.union1d(a, b)            # 并集
np.setdiff1d(a, b)          # 差集
np.isin(arr, values)        # 成员测试
```

### 排序

```python
np.sort(arr)                # 排序（返回拷贝）
arr.sort()                  # 原地排序
np.argsort(arr)             # 排序索引
np.partition(arr, k)        # 部分排序
```

### Einstein求和

```python
# 矩阵乘法
np.einsum('ij,jk->ik', A, B)

# 点积
np.einsum('i,i->', a, b)

# 外积
np.einsum('i,j->ij', a, b)

# 批量操作
np.einsum('bij,bjk->bik', A, B)
```

## 性能技巧

```python
# 使用向量化
# 避免: for i in range(len(arr)): ...
# 使用: arr + 1

# 原地操作
arr += 1            # 而不是 arr = arr + 1

# 指定输出
np.add(a, b, out=result)

# 合适的数据类型
arr.astype(np.float32)  # 而不是默认的float64

# 检查连续性
arr.flags['C_CONTIGUOUS']
arr = np.ascontiguousarray(arr)

# 避免拷贝
view = arr[1:10]    # 切片是视图
copy = arr.copy()   # 显式拷贝
```

## 调试和检查

```python
# 数组信息
print(arr.shape, arr.dtype, arr.size)

# 内存信息
print(arr.nbytes / 1024**2, "MB")

# 检查共享内存
np.shares_memory(arr1, arr2)

# 检查NaN/Inf
np.isnan(arr).any()
np.isinf(arr).any()
np.isfinite(arr).all()

# 断言（测试）
from numpy.testing import assert_array_equal
assert_array_equal(actual, expected)
```

## 常用常量

```python
np.pi           # π
np.e            # 自然对数底
np.inf          # 正无穷
np.nan          # Not a Number
np.euler_gamma  # 欧拉常数
```

---

**更多详细信息请参考完整文档**: [README.md](README.md)
