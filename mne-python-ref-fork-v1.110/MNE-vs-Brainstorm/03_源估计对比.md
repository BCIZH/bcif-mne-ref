# æºä¼°è®¡å¯¹æ¯”: MNE-Python vs Brainstorm3

> **ä¸“é¢˜**: æºç©ºé—´å®šä½ç®—æ³•ä¸å·¥ä½œæµå¯¹æ¯”  
> **æ›´æ–°**: 2026å¹´1æœˆ31æ—¥

---

## ç›®å½•

1. [æºä¼°è®¡åŸºç¡€](#æºä¼°è®¡åŸºç¡€)
2. [æ­£å‘å»ºæ¨¡](#æ­£å‘å»ºæ¨¡)
3. [æœ€å°èŒƒæ•°ä¼°è®¡](#æœ€å°èŒƒæ•°ä¼°è®¡)
4. [æ³¢æŸæˆå½¢](#æ³¢æŸæˆå½¢)
5. [ç¨€ç–æ–¹æ³•](#ç¨€ç–æ–¹æ³•)
6. [å·¥ä½œæµå¯¹æ¯”](#å·¥ä½œæµå¯¹æ¯”)

---

## æºä¼°è®¡åŸºç¡€

### å…±äº«çš„æ•°å­¦æ¡†æ¶

**æ­£é—®é¢˜**:
$$\mathbf{M} = \mathbf{G} \mathbf{J} + \mathbf{n}$$

**é€†é—®é¢˜**:
$$\hat{\mathbf{J}} = \mathbf{W} \mathbf{M}$$

ä¸¤è€…éƒ½åŸºäºç›¸åŒçš„ç”µç£ç†è®ºå’Œæ±‚è§£ç®—æ³•!

---

## æ­£å‘å»ºæ¨¡

### ç›¸åŒç‚¹: BEM + çƒå¤´æ¨¡å‹

| ç»„ä»¶ | MNE-Python | Brainstorm3 | ä¸€è‡´æ€§ |
|------|------------|-------------|--------|
| **æºç©ºé—´** | çš®å±‚è¡¨é¢ (Freesurfer) | çš®å±‚è¡¨é¢ (Freesurfer/BrainVISA) | âœ… |
| **å¤´æ¨¡å‹** | BEM (OpenMEEG/MNE-C) | BEM (OpenMEEG) | âœ… ç›¸åŒå¼•æ“ |
| **çƒå¤´æ¨¡å‹** | å•/å¤šçƒå£³ | å•/å¤šçƒå£³ | âœ… |
| **å¯¼è”åœºè®¡ç®—** | MNE-C/Python | Brainstormå†…ç½® | âœ… ç›¸åŒåŸç† |

---

### MNE-Python: æ­£å‘å»ºæ¨¡æµç¨‹

```python
import mne

# ========================================
# 1. æºç©ºé—´ (Source Space)
# ========================================

# æ–¹æ³•A: ä½¿ç”¨Freesurferé‡å»ºçš„çš®å±‚
subjects_dir = '/path/to/subjects'
subject = 'fsaverage'

src = mne.setup_source_space(
    subject, 
    spacing='oct6',      # ~4098 dipoles/hemisphere
    subjects_dir=subjects_dir,
    add_dist=False       # è·ç¦»çŸ©é˜µ (ç”¨äºç©ºé—´å¹³æ»‘)
)

print(src)
# <SourceSpaces: [<surface (lh), n_vertices=155407, n_used=4098>,
#                  <surface (rh), n_vertices=156866, n_used=4098>] MRI (surface RAS) coords>

# æ–¹æ³•B: ä½“æºç©ºé—´
vol_src = mne.setup_volume_source_space(
    subject,
    pos=5.0,             # 5mmç½‘æ ¼é—´è·
    subjects_dir=subjects_dir
)

# ========================================
# 2. è¾¹ç•Œå…ƒæ¨¡å‹ (BEM)
# ========================================

# 2.1 åˆ›å»ºBEMè¡¨é¢ (éœ€è¦Freesurfer)
mne.bem.make_watershed_bem(
    subject, 
    subjects_dir=subjects_dir,
    overwrite=True
)

# 2.2 åˆ›å»ºBEMè§£ (å•å±‚æˆ–ä¸‰å±‚)
conductivity = (0.3,)  # å•å±‚ (ä»…è„‘)
# conductivity = (0.3, 0.006, 0.3)  # ä¸‰å±‚ (è„‘ã€é¢…éª¨ã€å¤´çš®)

model = mne.make_bem_model(
    subject, 
    conductivity=conductivity,
    subjects_dir=subjects_dir
)

bem = mne.make_bem_solution(model)

# 2.3 æˆ–ä½¿ç”¨çƒå¤´æ¨¡å‹ (å¿«é€Ÿè¿‘ä¼¼)
sphere = mne.make_sphere_model(
    r0='auto',   # è‡ªåŠ¨æ‹Ÿåˆå¤´éƒ¨ä¸­å¿ƒ
    head_radius='auto',
    info=raw.info
)

# ========================================
# 3. ä¼ æ„Ÿå™¨-å¤´éƒ¨é…å‡†
# ========================================

# 3.1 åŠ è½½æ•°å­—åŒ–ç‚¹ (å¤´éƒ¨å½¢çŠ¶, ç”µæä½ç½®)
# é€šå¸¸å·²åŒ…å«åœ¨æ•°æ®æ–‡ä»¶ä¸­
info = raw.info

# 3.2 ååŒé…å‡† (GUIå·¥å…·)
mne.gui.coregistration(
    subject=subject, 
    subjects_dir=subjects_dir
)

# 3.3 æˆ–ä»transæ–‡ä»¶åŠ è½½
trans = mne.read_trans('subject-trans.fif')

# ========================================
# 4. è®¡ç®—æ­£å‘è§£ (Forward Solution)
# ========================================

fwd = mne.make_forward_solution(
    info,                # ä¼ æ„Ÿå™¨ä¿¡æ¯
    trans=trans,         # å¤´éƒ¨-MRIå˜æ¢
    src=src,             # æºç©ºé—´
    bem=bem,             # BEMæ¨¡å‹
    meg=True,            # è®¡ç®—MEGå¯¼è”åœº
    eeg=True,            # è®¡ç®—EEGå¯¼è”åœº
    mindist=5.0,         # æœ€å°æºè·ç¦» (mm)
    n_jobs=4             # å¹¶è¡Œè®¡ç®—
)

print(fwd)
# <Forward | MEG channels: 306 | EEG channels: 60 | Source space: Surface with 8196 vertices | ...>

# å¯¼è”åœºçŸ©é˜µ
G = fwd['sol']['data']  # [n_channels Ã— 3*n_sources]
print(G.shape)          # (366, 24588) - 306 MEG + 60 EEG

# ========================================
# 5. ä¿å­˜/åŠ è½½
# ========================================
mne.write_forward_solution('subject-fwd.fif', fwd)
fwd = mne.read_forward_solution('subject-fwd.fif')
```

---

### Brainstorm3: æ­£å‘å»ºæ¨¡æµç¨‹

```matlab
% ========================================
% GUIå·¥ä½œæµ (çº¦10-15æ¬¡ç‚¹å‡»)
% ========================================

% 1. å¯¼å…¥è§£å‰–ç»“æ„
% - Anatomy > Import MRI
% - è‡ªåŠ¨è°ƒç”¨Freesurferæˆ–æ‰‹åŠ¨åˆ†å‰²

% 2. ç”Ÿæˆçš®å±‚è¡¨é¢
% - Generate surfaces (è‡ªåŠ¨: 15000 vertices)
% - æˆ–ä»Freesurferå¯¼å…¥

% 3. é…å‡†ç”µæ/ä¼ æ„Ÿå™¨
% - Channel editor
% - æ‹–æ‹½è°ƒæ•´ä¼ æ„Ÿå™¨ä½ç½®

% 4. è®¡ç®—å¤´æ¨¡å‹
% - å³é”®å—è¯•è€… > Compute head model
% - é€‰æ‹©BEMæˆ–çƒæ¨¡å‹
% - OpenMEEG (BEM) æˆ– Overlapping spheres

% ========================================
% è„šæœ¬è°ƒç”¨
% ========================================

% 1. å¯¼å…¥MRI
sFiles = bst_process('CallProcess', 'process_import_anatomy', [], [], ...
    'subjectname', 'Subject01', ...
    'mrifile',     {'/path/to/mri.nii', 'All'}, ...
    'nvertices',   15000);

% 2. è®¡ç®—å¤´æ¨¡å‹
sFiles = bst_process('CallProcess', 'process_headmodel', sFiles, [], ...
    'sourcespace', 1, ...          % 1=Cortex, 2=MRI volume
    'meg',         3, ...          % 1=Single sphere, 3=OpenMEEG BEM
    'eeg',         3, ...          % BEM
    'openmeeg', struct(...
        'BemSelect',    [1, 1, 1], ...  % [è„‘, é¢…éª¨, å¤´çš®]
        'BemCond',      [1, 0.0125, 1], ...  % ç”µå¯¼ç‡
        'BemNames',     {{'brain', 'skull', 'scalp'}}, ...
        'BemFiles',     {{}}));

% æŸ¥çœ‹å¤´æ¨¡å‹
HeadModelMat = in_bst_headmodel(HeadModelFile);
G = HeadModelMat.Gain;  % [n_channels Ã— 3*n_sources]
GridLoc = HeadModelMat.GridLoc;  % [n_sources Ã— 3]
```

**å…³é”®å·®å¼‚**:

| ç‰¹æ€§ | MNE-Python | Brainstorm3 |
|------|------------|-------------|
| **ä¾èµ–Freesurfer** | âœ… æ¨è (å¯é€‰å…¶ä»–) | âœ… æ¨è (æˆ–å†…ç½®åˆ†å‰²) |
| **BEMå¼•æ“** | OpenMEEG / MNE-C | OpenMEEG |
| **æºç©ºé—´å¯†åº¦** | oct6 (~4098/åŠçƒ) | 15000 vertices (é»˜è®¤) |
| **é…å‡†å·¥å…·** | GUI (mne.gui.coregistration) | GUIå†…ç½® |
| **è‡ªåŠ¨åŒ–** | â­â­â­â­â­ è„šæœ¬åŒ– | â­â­â­ GUIä¸»å¯¼ |

---

## æœ€å°èŒƒæ•°ä¼°è®¡

### ç›¸åŒç®—æ³•: MNE, dSPM, sLORETA

**æ•°å­¦å…¬å¼ä¸€è‡´**:
$$\mathbf{W} = \mathbf{R} \mathbf{G}^T (\mathbf{G} \mathbf{R} \mathbf{G}^T + \lambda \mathbf{C})^{-1}$$

---

### MNE-Python: æœ€å°èŒƒæ•°æ±‚è§£å™¨

```python
from mne.minimum_norm import (
    make_inverse_operator, 
    apply_inverse, 
    apply_inverse_epochs
)

# ========================================
# 1. å™ªå£°åæ–¹å·®çŸ©é˜µ (Noise Covariance)
# ========================================

# ä»åŸºçº¿è®¡ç®—
noise_cov = mne.compute_covariance(
    epochs, 
    tmin=-0.2, tmax=0,   # åŸºçº¿æœŸ
    method='empirical',  # 'empirical' | 'shrunk' | 'auto'
    rank='info'          # è‡ªåŠ¨ç§©ä¼°è®¡
)

# æˆ–ä»ç©ºæˆ¿é—´è®°å½•
noise_cov = mne.compute_raw_covariance(empty_room_raw)

# ========================================
# 2. æ•°æ®åæ–¹å·®çŸ©é˜µ (å¯é€‰)
# ========================================
data_cov = mne.compute_covariance(
    epochs,
    tmin=0, tmax=0.5,    # åˆºæ¿€å
    method='empirical'
)

# ========================================
# 3. åˆ›å»ºé€†ç®—å­ (Inverse Operator)
# ========================================

inv = make_inverse_operator(
    info=evoked.info,    # æ•°æ®ä¿¡æ¯
    forward=fwd,         # æ­£å‘è§£
    noise_cov=noise_cov, # å™ªå£°åæ–¹å·®
    loose=0.2,           # æ¾å¼›æ–¹å‘çº¦æŸ (0=å›ºå®š, 1=è‡ªç”±)
    depth=0.8,           # æ·±åº¦åŠ æƒ (0-1)
    fixed=False,         # False=3ä¸ªæ–¹å‘, True=1ä¸ªæ–¹å‘
    rank='info'          # è‡ªåŠ¨ç§©
)

# ========================================
# 4. åº”ç”¨é€†ç®—å­ (æºä¼°è®¡)
# ========================================

# 4.1 åº”ç”¨åˆ°å¹³å‡æ•°æ®
stc = apply_inverse(
    evoked, 
    inv, 
    lambda2=1.0 / 9.0,   # æ­£åˆ™åŒ–å‚æ•° (1/SNRÂ²)
    method='dSPM',       # 'MNE' | 'dSPM' | 'sLORETA'
    pick_ori='normal'    # 'normal' | 'vector' | None
)

print(stc)
# <SourceEstimate | 7498 vertices, tmin=-0.2, tmax=0.5, tstep=0.001 (ms), subject 'fsaverage', dSPM>

# 4.2 åº”ç”¨åˆ°å•è¯•æ¬¡
stcs = apply_inverse_epochs(
    epochs, 
    inv, 
    lambda2=1.0/9.0,
    method='dSPM'
)

# ========================================
# 5. å‚æ•°è°ƒä¼˜
# ========================================

# SNRçš„é€‰æ‹©
# lambda2 = 1 / SNRÂ²
# - é«˜SNR (å¥½æ•°æ®) â†’ lambda2 å° (1/100)
# - ä½SNR (å™ªå£°å¤§) â†’ lambda2 å¤§ (1/9)

# å¸¸ç”¨å€¼:
lambda2_high_snr = 1.0 / 100.0   # SNR=10
lambda2_medium_snr = 1.0 / 9.0   # SNR=3 (é»˜è®¤)
lambda2_low_snr = 1.0 / 4.0      # SNR=2
```

**ç®—æ³•ç»†èŠ‚**:

```python
# dSPMå®ç°
def compute_dspm(W, noise_cov):
    """
    W: é€†ç®—å­ [n_sources Ã— n_channels]
    noise_cov: å™ªå£°åæ–¹å·® [n_channels Ã— n_channels]
    """
    # è®¡ç®—æºå™ªå£°åæ–¹å·®
    source_cov = W @ noise_cov @ W.T  # [n_sources Ã— n_sources]
    
    # æå–å¯¹è§’çº¿ (æºæ–¹å·®)
    source_std = np.sqrt(np.diag(source_cov))  # [n_sources]
    
    # æ ‡å‡†åŒ–
    # dSPM(i,t) = J(i,t) / std(i)
    return source_std

# sLORETAå®ç°
def compute_sloreta(W, noise_cov):
    """æ ‡å‡†åŒ–ä½åˆ†è¾¨ç‡ç”µç£æ–­å±‚æˆåƒ"""
    # åˆ†è¾¨ç‡çŸ©é˜µ
    R = W @ G  # [n_sources Ã— n_sources]
    
    # æºåæ–¹å·®
    S = W @ noise_cov @ W.T
    
    # sLORETAæ ‡å‡†åŒ–
    # sLORETA(i,t) = J(i,t) / sqrt(R(i,i) * S(i,i))
    norm = np.sqrt(np.diag(R) * np.diag(S))
    return norm
```

---

### Brainstorm3: æœ€å°èŒƒæ•°æ±‚è§£å™¨

```matlab
% ========================================
% GUIå·¥ä½œæµ
% ========================================

% 1. è®¡ç®—å™ªå£°åæ–¹å·®
% - å³é”®æ•°æ® > Noise covariance > Compute from recordings
% - é€‰æ‹©åŸºçº¿æœŸ: -200ms to 0ms

% 2. è®¡ç®—æºä¼°è®¡
% - Process > Sources > Compute sources [2018]
% - æ–¹æ³•: MN, dSPM, sLORETA
% - SNR: 3 (é»˜è®¤)

% ========================================
% è„šæœ¬è°ƒç”¨
% ========================================

% 1. å™ªå£°åæ–¹å·®
sFiles = bst_process('CallProcess', 'process_noisecov', sFiles, [], ...
    'baseline',       [-0.2, 0], ...
    'sensortypes',    'MEG, EEG', ...
    'target',         1, ...     % 1=æ•°æ®åæ–¹å·®
    'dcoffset',       1, ...     % ç§»é™¤DC
    'identity',       0, ...     % 0=å®Œæ•´, 1=å¯¹è§’
    'copycond',       0, ...
    'copysubj',       0);

% 2. æºä¼°è®¡
sFiles = bst_process('CallProcess', 'process_inverse_2018', sFiles, [], ...
    'output',         1, ...     % 1=Kernel, 2=Full results
    'inverse', struct(...
        'Comment',        'MN: MEG', ...
        'InverseMethod',  'minnorm', ...  % 'minnorm', 'gls', 'lcmv'
        'InverseMeasure', 'dspm', ...     % 'amplitude', 'dspm', 'sloreta'
        'SourceOrient',   {{'fixed'}}, ... % 'fixed', 'loose', 'free'
        'Loose',          0.2, ...
        'UseDepth',       1, ...
        'WeightExp',      0.5, ...
        'WeightLimit',    10, ...
        'NoiseMethod',    'reg', ...      % æ­£åˆ™åŒ–æ–¹æ³•
        'NoiseReg',       0.1, ...
        'SnrMethod',      'fixed', ...
        'SnrRms',         1e-06, ...
        'SnrFixed',       3, ...          % SNR=3
        'ComputeKernel',  1, ...
        'DataTypes',      {{'MEG'}}));

% æŸ¥çœ‹ç»“æœ
ResultsMat = in_bst_results(ResultsFile);
ImageGridAmp = ResultsMat.ImageGridAmp;  % [n_sources Ã— n_times]
```

**å‚æ•°å¯¹æ¯”**:

| å‚æ•° | MNE-Python | Brainstorm3 | é»˜è®¤å€¼ä¸€è‡´æ€§ |
|------|------------|-------------|--------------|
| **SNR** | `lambda2 = 1/SNRÂ²` | `SnrFixed` | âœ… 3 |
| **æ–¹å‘çº¦æŸ** | `loose` | `Loose` | âœ… 0.2 |
| **æ·±åº¦åŠ æƒ** | `depth` | `WeightExp` | âœ… 0.5-0.8 |
| **æ–¹æ³•** | `method` | `InverseMeasure` | âœ… ç›¸åŒé€‰é¡¹ |
| **æºæ–¹å‘** | `fixed=True/False` | `SourceOrient` | âœ… |

---

## æ³¢æŸæˆå½¢ (Beamformer)

### ç›¸åŒç®—æ³•: LCMV, DICS

**LCMV (çº¿æ€§çº¦æŸæœ€å°æ–¹å·®)**:
$$\mathbf{w}_r = \frac{\mathbf{C}^{-1} \mathbf{l}_r}{\mathbf{l}_r^T \mathbf{C}^{-1} \mathbf{l}_r}$$

---

### MNE-Python: Beamformer

```python
from mne.beamformer import (
    make_lcmv, 
    apply_lcmv, 
    apply_lcmv_epochs,
    make_dics,
    apply_dics
)

# ========================================
# LCMV (æ—¶åŸŸæ³¢æŸæˆå½¢)
# ========================================

# 1. æ•°æ®åæ–¹å·®
data_cov = mne.compute_covariance(
    epochs, 
    tmin=0.04, tmax=0.15,
    method='empirical'
)

# 2. å™ªå£°åæ–¹å·®
noise_cov = mne.compute_covariance(
    epochs, 
    tmin=-0.2, tmax=0,
    method='empirical'
)

# 3. åˆ›å»ºLCMVç©ºé—´æ»¤æ³¢å™¨
filters = make_lcmv(
    info=epochs.info,
    forward=fwd,
    data_cov=data_cov,
    reg=0.05,            # æ­£åˆ™åŒ–
    noise_cov=noise_cov,
    pick_ori='max-power', # 'max-power' | 'normal' | 'vector'
    weight_norm='unit-noise-gain',  # å½’ä¸€åŒ–
    rank='info'
)

# 4. åº”ç”¨
stc = apply_lcmv(evoked, filters)

# ========================================
# DICS (é¢‘åŸŸæ³¢æŸæˆå½¢)
# ========================================

# 1. è®¡ç®—äº¤å‰è°±å¯†åº¦
freqs = [10, 12]  # 10-12 Hz (alpha)

# æ´»åŠ¨æœŸ
csd = mne.time_frequency.csd_morlet(
    epochs, 
    frequencies=freqs, 
    tmin=0, tmax=0.5,
    n_cycles=7
)

# åŸºçº¿æœŸ
csd_baseline = mne.time_frequency.csd_morlet(
    epochs,
    frequencies=freqs,
    tmin=-0.5, tmax=0
)

# 2. åˆ›å»ºDICSæ»¤æ³¢å™¨
filters = make_dics(
    info=epochs.info,
    forward=fwd,
    csd=csd,
    reg=0.05,
    pick_ori='max-power'
)

# 3. åº”ç”¨
stc, freqs = apply_dics(evoked, filters)

# å¯¹æ¯”æ¿€æ´»
stc_baseline, _ = apply_dics(evoked, filters, csd_baseline)
stc_contrast = (stc - stc_baseline) / stc_baseline  # å½’ä¸€åŒ–å¯¹æ¯”
```

---

### Brainstorm3: Beamformer

```matlab
% ========================================
% GUI: Process > Sources > LCMV beamformer
% ========================================

sFiles = bst_process('CallProcess', 'process_inverse_2018', sFiles, [], ...
    'output',  1, ...
    'inverse', struct(...
        'InverseMethod', 'lcmv', ...
        'DataTypes',     {{'MEG'}}, ...
        'Loose',         0, ...         % å›ºå®šæ–¹å‘
        'UseDepth',      0, ...         % ä¸ä½¿ç”¨æ·±åº¦åŠ æƒ
        'NoiseMethod',   'median'));    % å™ªå£°ä¼°è®¡
```

---

## ç¨€ç–æ–¹æ³•

### MNE-Python: ç¨€ç–æ±‚è§£å™¨

```python
from mne.inverse_sparse import (
    mixed_norm, 
    gamma_map, 
    tf_mixed_norm
)

# ========================================
# Mixed-Norm Estimate (MxNE)
# ========================================

stc = mixed_norm(
    evoked, 
    fwd, 
    noise_cov,
    alpha=50,         # ç¨€ç–åº¦å‚æ•°
    loose=0.2,
    depth=0.8,
    maxit=3000,
    tol=1e-4
)

# ========================================
# Gamma-MAP
# ========================================

stc = gamma_map(
    evoked,
    fwd,
    noise_cov,
    alpha=0.5,
    loose=0.2
)

# ========================================
# æ—¶é¢‘MxNE
# ========================================

stc = tf_mixed_norm(
    epochs,
    fwd,
    noise_cov,
    alpha=50,
    loose=0.2,
    tstep=4,
    wsize=16
)
```

---

### Brainstorm3: ç¨€ç–æ–¹æ³• (æœ‰é™)

```matlab
% ========================================
% MSP (Multiple Sparse Priors) - SPMå®ç°
% ========================================

% éœ€è¦SPMæ’ä»¶
sFiles = bst_process('CallProcess', 'process_inverse_2018', sFiles, [], ...
    'inverse', struct(...
        'InverseMethod', 'msp'));  % SPMçš„MSPç®—æ³•
```

**å·®å¼‚**:
- âœ… MNE-Python: å¤šç§ç¨€ç–æ–¹æ³•åŸç”Ÿå®ç°
- âš–ï¸ Brainstorm3: æœ‰é™æ”¯æŒ,ä¾èµ–SPMæ’ä»¶

---

## å·¥ä½œæµå¯¹æ¯”

### å®Œæ•´æºä¼°è®¡æµç¨‹

#### MNE-Python

```python
import mne
from mne.minimum_norm import make_inverse_operator, apply_inverse

# ========================================
# å®Œæ•´å·¥ä½œæµ (çº¦50è¡Œä»£ç )
# ========================================

# 1. åŠ è½½æ•°æ®
evoked = mne.read_evokeds('evoked-ave.fif')[0]

# 2. æºç©ºé—´
subjects_dir = '/path/to/subjects'
src = mne.setup_source_space('fsaverage', spacing='oct6', 
                              subjects_dir=subjects_dir)

# 3. BEM
conductivity = (0.3,)
model = mne.make_bem_model('fsaverage', conductivity=conductivity,
                            subjects_dir=subjects_dir)
bem = mne.make_bem_solution(model)

# 4. é…å‡† (å‡è®¾å·²å®Œæˆ)
trans = 'fsaverage-trans.fif'

# 5. æ­£å‘è§£
fwd = mne.make_forward_solution(
    evoked.info, trans, src, bem,
    meg=True, eeg=False, n_jobs=4
)

# 6. å™ªå£°åæ–¹å·®
epochs = mne.read_epochs('epochs-epo.fif')
noise_cov = mne.compute_covariance(
    epochs, tmax=0, method='empirical'
)

# 7. é€†ç®—å­
inv = make_inverse_operator(
    evoked.info, fwd, noise_cov,
    loose=0.2, depth=0.8
)

# 8. æºä¼°è®¡
stc = apply_inverse(
    evoked, inv, lambda2=1.0/9.0, method='dSPM'
)

# 9. å¯è§†åŒ–
brain = stc.plot(
    subjects_dir=subjects_dir,
    hemi='split',
    time_viewer=True
)

# 10. ä¿å­˜
stc.save('stc-dSPM')

print("æºä¼°è®¡å®Œæˆ!")
```

---

#### Brainstorm3

```
GUIå·¥ä½œæµ (çº¦20-25æ¬¡ç‚¹å‡»):

1. [å¯¼å…¥è§£å‰–]
   - Anatomy > Import MRI
   - Generate surfaces

2. [é…å‡†]
   - å³é”®é€šé“ > Channel editor
   - è°ƒæ•´ä¼ æ„Ÿå™¨ä½ç½®

3. [å¤´æ¨¡å‹]
   - å³é”®å—è¯•è€… > Compute head model
   - OpenMEEG BEM
   - Run

4. [å™ªå£°åæ–¹å·®]
   - å³é”®æ•°æ® > Noise covariance
   - Baseline: -200ms to 0
   - Run

5. [æºä¼°è®¡]
   - Process > Sources > Compute sources
   - Method: dSPM
   - SNR: 3
   - Run

6. [å¯è§†åŒ–]
   - åŒå‡»ç»“æœ
   - æ˜¾ç¤ºåœ¨çš®å±‚ä¸Š

7. [å¯¼å‡º]
   - File > Export
   - é€‰æ‹©æ ¼å¼
```

---

## åŠŸèƒ½å¯¹æ¯”æ€»ç»“

| åŠŸèƒ½ | MNE-Python | Brainstorm3 | ç®—æ³•ä¸€è‡´æ€§ |
|------|------------|-------------|-----------|
| **æºç©ºé—´** | Freesurfer/è‡ªå®šä¹‰ | Freesurfer/å†…ç½® | âœ… |
| **BEM** | OpenMEEG/MNE-C | OpenMEEG | âœ… ç›¸åŒå¼•æ“ |
| **MNE/dSPM/sLORETA** | âœ… | âœ… | âœ… å®Œå…¨ç›¸åŒ |
| **LCMV** | âœ… | âœ… | âœ… |
| **DICS** | âœ… | âœ… | âœ… |
| **ç¨€ç–æ–¹æ³•** | â­â­â­â­â­ (MxNE, Gamma-MAP) | â­â­ (SPMæ’ä»¶) | âš–ï¸ MNEæ›´å¤š |
| **åŠ¨æ€æº** | âœ… (RAP-MUSIC, MUSIC) | âŒ | âš–ï¸ MNEç‹¬æœ‰ |
| **è‡ªåŠ¨åŒ–** | â­â­â­â­â­ | â­â­â­ | - |
| **æ‰¹é‡å¤„ç†** | â­â­â­â­â­ | â­â­â­ | - |
| **å¯è§†åŒ–** | â­â­â­â­ (3Däº¤äº’) | â­â­â­â­â­ (GUIé›†æˆ) | - |

---

## å„è‡ªä¼˜åŠ¿

### MNE-Python æºä¼°è®¡ä¼˜åŠ¿

1. âœ… **ç¨€ç–æ–¹æ³•ä¸°å¯Œ**: MxNE, Gamma-MAP, TF-MxNE
2. âœ… **åŠ¨æ€æºä¼°è®¡**: RAP-MUSIC (ECD)
3. âœ… **çµæ´»å®šåˆ¶**: è‡ªå®šä¹‰é€†ç®—å­
4. âœ… **æ‰¹é‡å¤„ç†**: å¤šå—è¯•è€…å¹¶è¡Œ
5. âœ… **æœºå™¨å­¦ä¹ é›†æˆ**: æºç©ºé—´è§£ç 

---

### Brainstorm3 æºä¼°è®¡ä¼˜åŠ¿

1. âœ… **GUIé…å‡†å·¥å…·**: å¯è§†åŒ–è°ƒæ•´ä¼ æ„Ÿå™¨
2. âœ… **å®æ—¶åé¦ˆ**: æ¯æ­¥éƒ½èƒ½æŸ¥çœ‹ç»“æœ
3. âœ… **è§£å‰–æ ‡æ³¨**: è‡ªåŠ¨è„‘åŒºæ ‡è®°
4. âœ… **è·¨æ¨¡æ€é›†æˆ**: MEG/EEG/fNIRSç»Ÿä¸€ç•Œé¢
5. âœ… **æ•™å­¦å‹å¥½**: æ­¥éª¤æ¸…æ™°ç›´è§‚

---

## é€‰æ‹©å»ºè®®

**é€‰æ‹© MNE-Python** å¦‚æœ:
- éœ€è¦ **ç¨€ç–é‡å»º** (MxNE)
- éœ€è¦ **åŠ¨æ€æºä¼°è®¡** (RAP-MUSIC)
- éœ€è¦ **æ‰¹é‡å¤„ç†** (å¤šå—è¯•è€…)
- ç†Ÿæ‚‰ **Pythonç¼–ç¨‹**

**é€‰æ‹© Brainstorm3** å¦‚æœ:
- **å•ä¸ªå—è¯•è€…** æ¢ç´¢æ€§åˆ†æ
- éœ€è¦ **äº¤äº’å¼é…å‡†** (GUIè°ƒæ•´)
- **æ•™å­¦æ¼”ç¤º** (å¯è§†åŒ–å‹å¥½)
- **è·¨æ¨¡æ€ç ”ç©¶** (MEG+fNIRS)

æ ¸å¿ƒç®—æ³•(MNE/dSPM/LCMV)å®Œå…¨ä¸€è‡´,ç»“æœå¯é‡å¤! ğŸ¯
